<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plano de 30 dias ‚Äî Rotina e Progresso</title>
  <style>
    :root {
      --bg: #0f172a; --fg: #e2e8f0; --muted: #94a3b8; --primary: #22c55e; --danger: #ef4444;
      --card: #111827; --border: #1f2937; --accent: #60a5fa; --ok: #22c55e; --bad: #ef4444;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--fg); background: linear-gradient(180deg, #0b1220, var(--bg));
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
    header {
      display: flex; gap: 16px; align-items: center; justify-content: space-between;
      border-bottom: 1px solid var(--border); padding-bottom: 12px;
    }
    h1 { font-size: 1.4rem; margin: 0; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .card {
      background: var(--card); border: 1px solid var(--border); border-radius: 12px;
      padding: 16px; margin-top: 16px;
    }
    label { display: block; margin-bottom: 8px; }
    input[type="text"], input[type="date"], input[type="time"], textarea {
      width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border);
      background: #0b1220; color: var(--fg);
    }
    .btn {
      background: var(--primary); color: #0b1220; border: none; border-radius: 10px;
      padding: 10px 14px; font-weight: 600; cursor: pointer;
    }
    .btn.secondary { background: var(--border); color: var(--fg); }
    .btn.danger { background: var(--danger); color: #0b1220; }
    .muted { color: var(--muted); font-size: 0.95rem; }
    .pill { display: inline-block; padding: 4px 8px; border: 1px solid var(--border); border-radius: 999px; font-size: 0.85rem; margin-left: 8px; }
    .tasks { display: grid; grid-template-columns: 1fr; gap: 8px; }
    .check { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border: 1px solid var(--border); border-radius: 10px; background: #0b1220; }
    .check input[type="checkbox"] { width: 18px; height: 18px; }
    .progress-bar { height: 14px; background: #0b1220; border: 1px solid var(--border); border-radius: 999px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #4ade80); width: 0%; transition: width .3s ease; }
    .week-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px; }
    .donut { display: flex; flex-direction: column; align-items: center; gap: 8px; }
    .donut svg { width: 84px; height: 84px; }
    .legend { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .legend .dot { width: 10px; height: 10px; border-radius: 999px; display: inline-block; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
    .cal-day {
      padding: 8px; border: 1px solid var(--border); border-radius: 8px; text-align: center;
      background: #0b1220; font-size: 0.9rem;
    }
    .cal-day.ok { outline: 2px solid rgba(34,197,94,.25); }
    .cal-day.bad { outline: 2px solid rgba(239,68,68,.25); }
    footer { border-top: 1px solid var(--border); margin-top: 24px; padding-top: 16px; text-align: center; }
    .quote { font-style: italic; color: #cbd5e1; }
    .extras-list .extra-item { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
    .extras-list input[type="text"] { flex: 1; }
    .extras-list button { padding: 8px 10px; }
    .top-actions { display: flex; gap: 8px; flex-wrap: wrap; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Plano de 30 dias ‚Äî Rotina e Progresso</h1>
      <div class="top-actions">
        <button id="notify-permission" class="btn">Ativar notifica√ß√µes</button>
        <button id="export-ics" class="btn secondary">Exportar calend√°rio (.ics)</button>
        <button id="reset-progress" class="btn danger">Zerar progresso</button>
      </div>
    </header>

    <div class="card">
      <h2>Configura√ß√µes do plano</h2>
      <div class="row">
        <div>
          <label>Nome do plano
            <input type="text" id="plan-name" placeholder="Ex.: Estudos + Rotina di√°ria" />
          </label>
        </div>
        <div>
          <label>Data de in√≠cio
            <input type="date" id="start-date" />
          </label>
        </div>
      </div>
      <p class="muted">Este plano organiza 30 dias a partir da data de in√≠cio.</p>
      <div style="margin-top:8px; display:flex; gap:8px;">
        <button id="save-plan" class="btn">Salvar plano</button>
        <button id="today-reminder" class="btn secondary">Agendar lembrete de hoje</button>
        <input type="time" id="reminder-time" style="max-width:160px;" />
      </div>
    </div>

    <div class="card">
      <h2>Hoje</h2>
      <p id="today-label" class="muted"></p>

      <div class="quote" id="daily-quote">‚ÄúA motiva√ß√£o aparece quando voc√™ aparece.‚Äù</div>

      <div class="tasks" id="fixed-tasks">
        <!-- Tarefas fixas renderizadas pelo JS -->
      </div>

      <div class="card" style="margin-top:12px;">
        <h3>Extras do dia</h3>
        <div class="extras-list" id="extras-list">
          <!-- extras renderizados -->
        </div>
        <div style="display:flex; gap:8px; margin-top:6px;">
          <input type="text" id="new-extra" placeholder="Adicionar tarefa extra..." />
          <button id="add-extra" class="btn secondary">Adicionar</button>
        </div>
      </div>

      <div style="margin-top:12px;">
        <label>Notas do dia
          <textarea id="notes" rows="4" placeholder="Como foi seu dia? O que funcionou, o que pode melhorar..."></textarea>
        </label>
      </div>

      <div style="margin-top:12px;">
        <strong>Progresso do dia:</strong>
        <div class="progress-bar" title="Porcentagem conclu√≠da hoje">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <p class="muted" id="progress-text" style="margin-top:6px;"></p>
      </div>
    </div>

    <div class="card">
      <h2>Semana atual ‚Äî Gr√°ficos circulares</h2>
      <p class="muted">Cada c√≠rculo representa um dia. Cada segmento representa uma tarefa (verde = feita, vermelho = n√£o feita). Passe o mouse para ver o resumo.</p>
      <div class="week-grid" id="week-grid">
        <!-- Donuts renderizados -->
      </div>
      <div class="legend">
        <span><span class="dot" style="background: var(--ok);"></span> Feita</span>
        <span><span class="dot" style="background: var(--bad);"></span> N√£o feita</span>
      </div>
    </div>

    <div class="card">
      <h2>Calend√°rio de 30 dias</h2>
      <p class="muted">Mostra o percentual conclu√≠do em cada dia.</p>
      <div class="calendar-grid" id="calendar-grid">
        <!-- dias renderizados -->
      </div>
    </div>

    <footer>
      <p class="muted">Tudo fica salvo no seu navegador. Dica: abra este arquivo sempre que for estudar para acompanhar e marcar seu progresso.</p>
    </footer>
  </div>

  <script>
    // ---------- Configura√ß√£o base ----------
    const FIXED_TASKS = [
      { key: 'biblia', label: 'Leitura da B√≠blia' },
      { key: 'oracao', label: 'Ora√ß√£o' },
      { key: 'flexoes', label: '10 flex√µes' },
      { key: 'abdominais', label: '20 abdominais' },
      { key: 'curso', label: 'Estudar o curso' }
    ];
    const QUOTES = [
      'Disciplina √© fazer mesmo quando a motiva√ß√£o n√£o aparece.',
      'Voc√™ n√£o precisa ser perfeito, s√≥ constante.',
      'Pequenos passos todos os dias somam grandes resultados.',
      'Hoje √© um bom dia para cuidar do seu futuro.',
      'Progresso, n√£o perfei√ß√£o.',
      'Seja gentil consigo hoje, mas siga firme.',
      'Voc√™ est√° construindo algo que vale a pena.'
    ];

    const state = {
      planName: localStorage.getItem('planName') || 'Plano de 30 dias',
      startDate: localStorage.getItem('startDate') || '',
      // Estrutura: progress[dayIndex] = { fixed: {key: boolean}, extras: [{text, done}], notes: string }
      progress: JSON.parse(localStorage.getItem('progress') || '[]')
    };

    function save() {
      localStorage.setItem('planName', state.planName);
      localStorage.setItem('startDate', state.startDate);
      localStorage.setItem('progress', JSON.stringify(state.progress));
      renderAll();
    }

    function ensureDay(dayIdx) {
      if (!state.progress[dayIdx]) {
        state.progress[dayIdx] = { fixed: {}, extras: [], notes: '' };
        FIXED_TASKS.forEach(t => { state.progress[dayIdx].fixed[t.key] = false; });
      }
    }

    function todayIndex() {
      if (!state.startDate) return null;
      const start = new Date(state.startDate); start.setHours(0,0,0,0);
      const now = new Date(); now.setHours(0,0,0,0);
      const diff = Math.round((now - start) / (1000*60*60*24));
      if (diff < 0 || diff >= 30) return null;
      return diff;
    }

    function dateForIndex(i) {
      const start = new Date(state.startDate); start.setHours(0,0,0,0);
      const d = new Date(start); d.setDate(start.getDate() + i); d.setHours(0,0,0,0);
      return d;
    }

    function fmtDayLabel(d) {
      return d.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: '2-digit' });
    }

    function completionForDay(dayIdx) {
      ensureDay(dayIdx);
      const day = state.progress[dayIdx];
      const total = FIXED_TASKS.length + day.extras.length;
      let doneCount = 0;
      FIXED_TASKS.forEach(t => { if (day.fixed[t.key]) doneCount++; });
      day.extras.forEach(e => { if (e.done) doneCount++; });
      const pct = total === 0 ? 0 : Math.round((doneCount / total) * 100);
      return { total, doneCount, pct };
    }

    // ---------- Render: Hoje ----------
    function renderToday() {
      const idx = todayIndex();
      const labelEl = document.getElementById('today-label');
      const fixedEl = document.getElementById('fixed-tasks');
      const notesEl = document.getElementById('notes');
      const progressFill = document.getElementById('progress-fill');
      const progressText = document.getElementById('progress-text');
      const quoteEl = document.getElementById('daily-quote');

      fixedEl.innerHTML = '';
      document.getElementById('extras-list').innerHTML = '';

      if (idx === null) {
        labelEl.textContent = 'Defina a data de in√≠cio para ver as tarefas de hoje.';
        notesEl.value = '';
        progressFill.style.width = '0%';
        progressText.textContent = '0 de 0 conclu√≠das (0%)';
        quoteEl.textContent = 'Defina o in√≠cio e comece com calma. Voc√™ consegue.';
        return;
      }

      ensureDay(idx);
      const d = dateForIndex(idx);
      labelEl.textContent = `${fmtDayLabel(d)} ‚Äî ${state.planName} (Dia ${idx + 1})`;

      // Frase motivacional baseada no dia da semana e progresso
      const c = completionForDay(idx).pct;
      const baseQuote = QUOTES[d.getDay() % QUOTES.length];
      quoteEl.textContent = c === 100 ? 'Perfeito hoje! Orgulho do seu esfor√ßo.' :
                            c >= 60 ? baseQuote :
                            'Tudo bem n√£o estar 100%. Continue. O importante √© n√£o parar.';

      // Tarefas fixas
      FIXED_TASKS.forEach(t => {
        const wrap = document.createElement('div');
        wrap.className = 'check';
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = !!state.progress[idx].fixed[t.key];
        cb.addEventListener('change', () => {
          state.progress[idx].fixed[t.key] = cb.checked;
          save();
        });
        const lbl = document.createElement('span');
        lbl.textContent = t.label;
        wrap.appendChild(cb);
        wrap.appendChild(lbl);
        fixedEl.appendChild(wrap);
      });

      // Extras
      const extrasList = document.getElementById('extras-list');
      state.progress[idx].extras.forEach((ex, i) => {
        const row = document.createElement('div');
        row.className = 'extra-item';
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = !!ex.done;
        cb.addEventListener('change', () => {
          state.progress[idx].extras[i].done = cb.checked;
          save();
        });
        const inp = document.createElement('input');
        inp.type = 'text'; inp.value = ex.text;
        inp.addEventListener('input', () => {
          state.progress[idx].extras[i].text = inp.value;
          save();
        });
        const del = document.createElement('button');
        del.className = 'btn danger'; del.textContent = 'Remover';
        del.addEventListener('click', () => {
          state.progress[idx].extras.splice(i, 1);
          save();
        });
        row.appendChild(cb); row.appendChild(inp); row.appendChild(del);
        extrasList.appendChild(row);
      });

      // Adicionar novo extra
      document.getElementById('add-extra').onclick = () => {
        const val = document.getElementById('new-extra').value.trim();
        if (!val) return;
        state.progress[idx].extras.push({ text: val, done: false });
        document.getElementById('new-extra').value = '';
        save();
      };

      // Notas
      notesEl.value = state.progress[idx].notes || '';
      notesEl.oninput = () => {
        state.progress[idx].notes = notesEl.value;
        save();
      };

      // Progresso
      const comp = completionForDay(idx);
      progressFill.style.width = `${comp.pct}%`;
      progressText.textContent = `${comp.doneCount} de ${comp.total} conclu√≠das (${comp.pct}%)`;
    }

    // ---------- Donut helpers ----------
    function createDonutSegments(values, colors) {
      // values = array de 1s (feitas) e 0s (n√£o feitas), cores do mesmo tamanho
      const total = values.length;
      const radius = 38;
      const circumference = 2 * Math.PI * radius;
      const segmentLen = total ? circumference / total : 0;
      let offset = 0;
      const svgNS = 'http://www.w3.org/2000/svg';
      const svg = document.createElementNS(svgNS, 'svg');
      svg.setAttribute('viewBox', '0 0 84 84');

      // fundo cinza claro (anel base)
      const base = document.createElementNS(svgNS, 'circle');
      base.setAttribute('cx', '42'); base.setAttribute('cy', '42'); base.setAttribute('r', String(radius));
      base.setAttribute('fill', 'none'); base.setAttribute('stroke', '#0b1220');
      base.setAttribute('stroke-width', '10');
      svg.appendChild(base);

      for (let i = 0; i < total; i++) {
        const seg = document.createElementNS(svgNS, 'circle');
        seg.setAttribute('cx', '42'); seg.setAttribute('cy', '42'); seg.setAttribute('r', String(radius));
        seg.setAttribute('fill', 'none');
        seg.setAttribute('stroke', colors[i]);
        seg.setAttribute('stroke-width', '10');
        seg.setAttribute('stroke-dasharray', `${segmentLen} ${circumference - segmentLen}`);
        seg.setAttribute('stroke-dashoffset', String(offset));
        seg.setAttribute('transform', 'rotate(-90 42 42)');
        svg.appendChild(seg);
        offset -= segmentLen;
      }
      return svg;
    }

    // ---------- Render: Semana atual ----------
    function renderWeek() {
      const grid = document.getElementById('week-grid');
      grid.innerHTML = '';
      const idx = todayIndex();
      if (idx === null) {
        grid.innerHTML = '<p class="muted">Defina a data de in√≠cio para ver os gr√°ficos da semana.</p>';
        return;
      }
      const startOfWeekIdx = idx - (new Date().getDay()); // domingo como 0
      for (let i = 0; i < 7; i++) {
        const dayIdx = startOfWeekIdx + i;
        const wrap = document.createElement('div');
        wrap.className = 'donut';
        const title = document.createElement('div');
        if (dayIdx < 0 || dayIdx >= 30) {
          title.textContent = '‚Äî';
          const svg = createDonutSegments([], []);
          wrap.appendChild(svg); wrap.appendChild(title);
          grid.appendChild(wrap); continue;
        }
        ensureDay(dayIdx);
        const dayDate = dateForIndex(dayIdx);
        title.textContent = dayDate.toLocaleDateString('pt-BR', { weekday: 'short' });

        // valores e cores (fixed + extras)
        const vals = [];
        const cols = [];
        FIXED_TASKS.forEach(t => {
          const done = !!state.progress[dayIdx].fixed[t.key];
          vals.push(done ? 1 : 0);
          cols.push(done ? getComputedStyle(document.documentElement).getPropertyValue('--ok').trim() : getComputedStyle(document.documentElement).getPropertyValue('--bad').trim());
        });
        state.progress[dayIdx].extras.forEach(ex => {
          const done = !!ex.done;
          vals.push(done ? 1 : 0);
          cols.push(done ? getComputedStyle(document.documentElement).getPropertyValue('--ok').trim() : getComputedStyle(document.documentElement).getPropertyValue('--bad').trim());
        });

        const svg = createDonutSegments(vals, cols);
        const comp = completionForDay(dayIdx);
        svg.setAttribute('title', `${fmtDayLabel(dayDate)} ‚Äî ${comp.doneCount}/${comp.total} conclu√≠das (${comp.pct}%)`);
        wrap.appendChild(svg);
        const pct = document.createElement('div');
        pct.className = 'muted';
        pct.textContent = `${comp.pct}%`;
        wrap.appendChild(pct);
        wrap.appendChild(title);
        grid.appendChild(wrap);
      }
    }

    // ---------- Render: Calend√°rio 30 dias ----------
    function renderCalendar() {
      const grid = document.getElementById('calendar-grid');
      grid.innerHTML = '';
      if (!state.startDate) {
        grid.innerHTML = '<p class="muted">Defina a data de in√≠cio para ver o calend√°rio.</p>';
        return;
      }
      for (let i = 0; i < 30; i++) {
        ensureDay(i);
        const comp = completionForDay(i);
        const day = document.createElement('div');
        day.className = 'cal-day ' + (comp.pct === 100 ? 'ok' : comp.pct === 0 ? 'bad' : '');
        const d = dateForIndex(i);
        day.innerHTML = `<div><strong>${i+1}</strong></div><div class="muted">${d.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })}</div><div>${comp.pct}%</div>`;
        day.title = `${fmtDayLabel(d)} ‚Äî ${comp.doneCount}/${comp.total} conclu√≠das (${comp.pct}%)`;
        grid.appendChild(day);
      }
    }

    // ---------- Lembretes ----------
    document.getElementById('notify-permission').addEventListener('click', async () => {
      if (!('Notification' in window)) { alert('Seu navegador n√£o suporta notifica√ß√µes.'); return; }
      const perm = await Notification.requestPermission();
      alert(perm === 'granted' ? 'Notifica√ß√µes ativadas.' : 'Notifica√ß√µes n√£o autorizadas.');
    });

    document.getElementById('today-reminder').addEventListener('click', () => {
      const time = document.getElementById('reminder-time').value;
      const idx = todayIndex();
      if (!time) { alert('Escolha um hor√°rio para o lembrete.'); return; }
      if (Notification.permission !== 'granted') { alert('Ative as notifica√ß√µes primeiro.'); return; }
      const [hh, mm] = time.split(':').map(Number);
      const now = new Date();
      const target = new Date();
      target.setHours(hh, mm, 0, 0);
      const ms = target - now;
      if (ms <= 0) { alert('Escolha um hor√°rio futuro.'); return; }

      const taskSummary = (() => {
        if (idx === null) return 'Ver tarefas do plano de 30 dias';
        const day = state.progress[idx];
        const pendentes = [];
        FIXED_TASKS.forEach(t => { if (!day.fixed[t.key]) pendentes.push(t.label); });
        return pendentes.length ? `Pendentes: ${pendentes.join(', ')}` : 'Tudo conclu√≠do hoje! üéâ';
      })();

      setTimeout(() => {
        new Notification('Lembrete do plano', { body: taskSummary, tag: 'plano30' });
      }, ms);
      alert('Lembrete agendado para hoje.');
    });

    // ---------- Exportar para calend√°rio ----------
    document.getElementById('export-ics').addEventListener('click', () => {
      if (!state.startDate) { alert('Defina a data de in√≠cio antes de exportar.'); return; }
      const start = new Date(state.startDate);
      const pad = n => String(n).padStart(2, '0');
      const toICS = d => `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}T090000Z`;
      let ics = 'BEGIN:VCALENDAR\nVERSION:2.0\nCALSCALE:GREGORIAN\nPRODID:-//Plano30//PT-BR//\n';
      for (let i = 0; i < 30; i++) {
        const d = new Date(start); d.setDate(start.getDate() + i);
        const uid = `plano30-${i}-${d.getTime()}@local`;
        const desc = FIXED_TASKS.map(t => `- ${t.label}`).join('\\n');
        ics += `BEGIN:VEVENT\nUID:${uid}\nDTSTAMP:${toICS(new Date())}\nDTSTART:${toICS(d)}\nDTEND:${toICS(d)}\nSUMMARY:${state.planName} ‚Äî Dia ${i+1}\nDESCRIPTION:${desc}\nEND:VEVENT\n`;
      }
      ics += 'END:VCALENDAR';
      const blob = new Blob([ics], { type: 'text/calendar;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'plano-30-dias.ics'; a.click();
      URL.revokeObjectURL(url);
    });

    // ---------- Configura√ß√µes do plano ----------
    document.getElementById('save-plan').addEventListener('click', () => {
      const name = document.getElementById('plan-name').value.trim();
      const date = document.getElementById('start-date').value;
      if (!date) { alert('Escolha a data de in√≠cio.'); return; }
      state.planName = name || 'Plano de 30 dias';
      state.startDate = date;
      // Inicializa estrutura de 30 dias se necess√°rio
      for (let i = 0; i < 30; i++) ensureDay(i);
      save();
      alert('Plano salvo!');
    });

    document.getElementById('reset-progress').addEventListener('click', () => {
      if (!confirm('Tem certeza que deseja zerar o progresso (fixas, extras e notas)?')) return;
      state.progress = [];
      save();
    });

    // ---------- Render geral ----------
    function renderAll() {
      document.getElementById('plan-name').value = state.planName;
      document.getElementById('start-date').value = state.startDate;
      renderToday();
      renderWeek();
      renderCalendar();
    }

    // Init
    renderAll();
  </script>
</body>
</html>
